%ECE-4784-Electrophysiology
%==========================
%Sanjay Ravi
%Georgia Tech ECE 4784
% simulation parameters
T_final = 100;
t = 0:T_final; %ms

% constants
g_K = 36; % mS/cm^2
g_Na = 120;
g_L = 0.3;
E_K = -12; %mV
E_Na = 115;
E_L = 10.6;
V_rest = -70;
%V_m = -70;
C_m = 1; %uF

Step = 10; %I have to pick a right value for this :(
V_m = zeros([1,T_final/Step]);

Alpha_m = zeros([1,T_final/Step]);
Beta_m = zeros([1,T_final/Step]);
Alpha_n = zeros([1,T_final/Step]);
Beta_n = zeros([1,T_final/Step]);
Alpha_h = zeros([1,T_final/Step]);
Beta_h = zeros([1,T_final/Step]);

delta_m = zeros([1,T_final/Step]);
delta_n = zeros([1,T_final/Step]);
delta_h = zeros([1,T_final/Step]);

I = 0;
I_Na = zeros([1,T_final/Step]);
I_K = zeros([1,T_final/Step]);
I_L = zeros([1,T_final/Step]);
I_ion = zeros([1,T_final/Step]);

m = zeros([1,T_final/Step]);
n = zeros([1,T_final/Step]);
h = zeros([1,T_final/Step]);

% Initial Values
V_m(1) = -70;
disp(V_m(1))
Alpha_m(1) = 0.1 * ((25-V_m(1))/(exp((25-V_m(1))/10) - 1));
disp(Alpha_m(1))
Beta_m(1) = 4* exp(-V_m(1)/18);
disp(Beta_m(1))
Alpha_n(1) = .01 * ((10-V_m(1))/(exp((10-V_m(1))/10) - 1));
disp(Alpha_n(1))
Beta_n(1) = .125 * exp(-V_m(1)/80);
disp(Beta_n(1))
Alpha_h(1) = .07 * exp(-V_m(1)/20);
disp(Alpha_h(1))
Beta_h(1) = 1/(exp((30-V_m(1))/10) + 1);
disp(Beta_h(1))

m(1) = Alpha_m /(Alpha_m + Beta_m);
disp(m(1))
n(1) = Alpha_n /(Alpha_n + Beta_n);
disp(n(1))
h(1) = Alpha_h /(Alpha_h + Beta_h);
disp(n(1))

I_Na(1) = m(1)^3 * g_Na * h(1) * (V_m(1)-E_Na);
disp(I_Na(1))
I_K(1) = n(1)^4 * g_K * (V_m(1)-E_K);
disp(I_K(1))
I_L(1) = g_L * (V_m(1)-E_L);
disp(I_L(1))
I_ion(1) = I-I_K(1)-I_Na(1)-I_L(1);
disp(I_ion(1))


% Basically Im trying to make it as array because it is shooting me memory
% error



for t = 0:t/step
  i = 1:10;  

Alpha_m(i) = 0.1 * ((25-V_m(i))/(exp((25-V_m(i))/10) - 1));
Beta_m(i) = 4* exp(-V_m(i)/18);
Alpha_n(i) = .01 * ((10-V_m(i))/(exp((10-V_m(i))/10) - 1));
Beta_n(i) = .125 * exp(-V_m(i)/80);
Alpha_h(i) = .07 * exp(-V_m(i)/20);
Beta_h(i) = 1/(exp((30-V_m(i))/10) + 1);

delta_m(i) = Alpha_m *(1-m)-Beta_m * m;
delta_n(i) = Alpha_n * (1-n)-Beta_n * n;
delta_h(i) = Alpha_h * (1-h)-Beta_h * h;

I_Na(i) = m^3 * g_Na * h * (V_m(i)-E_Na);
I_K(i) = n^4 * g_K * (V_m(i)-E_K);
I_L(i) = g_L * (V_m(i)-E_L);
I_ion(i) = I-I_K-I_Na-I_L;

DeltaV_m = I_ion(i)/C_m;


V_m(i+1) = V_m(i) + step * DeltaV_m;

end
